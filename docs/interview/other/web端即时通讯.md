---
title: Web端即时通讯
order: 1
nav:
  order: 1
  title: 面试
toc: menu

---

# Web端即时通讯

Web端即时通讯技术：服务器端可以即时地将数据的更新或变化反应到客户端，例如消息即时推送等功能都是通过这种技术实现的。

实现Web端即时通讯的方法：实现即时通讯主要有四种方式，分别是轮询、长轮询(Comet)、长连接(SSE)、WebSocket。它们可以分为两类，一种是在HTTP基础上实现的，包括短轮询、长轮询和长连接；另一种不是在HTTP基础上实现的，即Websocket。

## 轮询

#### 原理

短轮询的基本思路就是浏览器每隔一段时间向浏览器发送http请求，服务器端在收到请求后，不论是否有数据更新，都直接进行响应。

>本质上还是浏览器发送请求，服务器接受请求的一个过程，通过让客户端不断的进行请求，使得客户端能够模拟实时地收到服务器端的数据的变化。

#### 优缺点

##### 优点

比较简单，易于理解，实现无难点

##### 缺点

由于需要不断的建立http连接，严重浪费了服务器端和客户端的资源。尤其是客户端，如果有数量级相对比较大的人同时位于基于短轮询的应用中，那么每一个用户的客户端都会疯狂地向服务器端发送http请求，而且不间断，人数越多，服务器端压力越大。

## 长轮询

#### 原理

ajax实现：

当服务器收到客户端发来的请求后，服务器端不会直接进行响应，而是先将这个请求挂起，然后判断服务器数据是否有更新，如果有更新，则进行响应，如果一直没有数据，则达到一定的时间限制（服务器端设置）才返回。客户端JavaScript响应处理函数会在处理完服务器返回的信息后，再次发出请求，重新建立连接。

#### 优缺点

##### 优点

减少了很多不必要的http请求次数，节约了资源

##### 缺点

连接挂起导致了资源浪费

## 长连接

#### 原理

SSE是HTML5新增的功能，全称Server-Sent Events，它允许服务推送数据到客户端。SSE最大的特点是不需要客户端发送请求，可以实现只要服务器端数据有更新，就可以马上发送到客户端。

#### 优缺点

##### 优点

不需要建立或者保持大量的客户端发往服务器端的请求，节约了很多资源，提升应用性能。实现简单，不需要依赖其他插件。

## WebSocket

#### 原理

WebSocket是HTML5定义的一个新协议，该协议可以实现服务器与客户端之间全双工通信。

简单来说，首先需要在客户端和服务器端建立起一个协议，这部分需要HTTP，连接一旦建立，客户端和服务器端就处于平等的地位，可以相互发送数据，不存在请求和响应的区别。

#### 优缺点

##### 优点

实现了双向通信

##### 缺点

服务器端的逻辑非常复杂，针对不同的后台语言有不同的插件可以使用。

## 综合

兼容性角度考虑：短轮询>长轮询>长连接SSE>WebSocket

性能角度考虑：WebSocket>长连接SSE>长轮询>短轮询

