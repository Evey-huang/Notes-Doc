---
title: 执行上下文
order: 1
nav:
  order: 1
  title: 面试
toc: menu
---

# **执行上下文和执行栈**

## 执行上下文

`执行上下文`就是当前JavaScript代码被解析和执行时所在环境的抽象概念，JavaScript中运行任何的代码都是在执行上下文中运行。

执行上下文的生命周期包括三个阶段：

- 创建阶段
- 执行阶段
- 回收阶段

### 创建阶段

`创建阶段`(当函数被调用，但未执行任何其内部代码之前)会做三件事：

- 创建变量对象： 首先初始化函数的参数arguments，提升函数声明和变量声明
- 创建作用域链
- 确定this指向

```js
function test(arg) {
  console.log(arg)
  var arg = 'hello'
  function arg() {
    console.log('hello world')
  }
	console.log(arg)
}
test('hi')
// 输出
/*
function arg() {
  console.log('hello world')
}
hello
*/
```

这是因为当函数执行的时候，首先会形成一个新的私有的作用域，然后依次按照如下的步骤执行：

- 如有形参，先给形参赋值
- 进行私有作用域中的预解释，函数声明优先级比变量声明高，最后后者会被前者所覆盖，但是可以重新赋值
- 私有作用域中的代码从上到下执行

## 执行栈

每个函数都有自己的执行上下文，每次调用函数都创建一个新的执行上下文，JavaScript引擎创建了`执行栈`来管理执行上下文。**可以把执行栈认为是一个存储函数调用的栈结构，遵循先进后出(FILO)的原则**。

根据执行上下文流程我们需要记住几个关键点：

- JavaScript执行在单线程上，所有的代码都是排队执行
- 一开始浏览器执行全局的代码时，首先创建全局的执行上下文，压入执行栈的顶部
- 每当进入一个函数的执行就会创建函数的执行上下文，并且把它压入执行栈的顶部。当前函数执行完成后，当前函数的执行上下文出栈，并等待垃圾回收
- 浏览器的JS执行引擎总是访问栈顶的执行上下文
- 全局上下文只有唯一的一个，它在浏览器关闭时出栈